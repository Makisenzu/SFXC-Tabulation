import{r,j as e,b as y}from"./app-CIBWa0BM.js";import{f as b,g as Ae,h as k,i as P,j as ee,k as te,l as se,m as ae,n as Se}from"./index-CgAFttlv.js";import{F as D}from"./FormModal-Dl2lsnTC.js";import{P as _e}from"./PrimaryButton-Cd1Lz8mM.js";import{s as l,c as Fe}from"./Sweetalert-Dn1acibP.js";import"./iconBase-DGXcwxyl.js";import"./TextInput-ByFAEcjB.js";function Te(){const[q,j]=r.useState([]),[U,v]=r.useState([]),[ne,$]=r.useState(!0),[M,re]=r.useState(null),[T,R]=r.useState(!1),[oe,I]=r.useState(!1),[ie,H]=r.useState(!1),[m,u]=r.useState(!1),[B,N]=r.useState(!1),[x,L]=r.useState(null),[h,G]=r.useState(null),[le,w]=r.useState({}),[ce,C]=r.useState({}),[de,E]=r.useState({photo:null}),[A,S]=r.useState(new Set),[_,xe]=r.useState(!1);r.useEffect(()=>{(async()=>{$(!0);try{const n=await fetch("/getEvents?per_page=100&show_past=true");if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const s=await n.json(),a=await fetch("/getContestants");if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);const o=await a.json();let i=[];s&&Array.isArray(s.data)?i=s.data:Array.isArray(s)?i=s:s&&Array.isArray(s.events)&&(i=s.events),j(i);let d=[];Array.isArray(o)?d=o:o&&Array.isArray(o.contestants)?d=o.contestants:o&&Array.isArray(o.data)&&(d=o.data),v(d)}catch(n){console.error("Error fetching data:",n),re(n.message),j([]),v([])}finally{$(!1)}})()},[]);const c=Array.isArray(q)?q:[],W=Array.isArray(U)?U:[],p=r.useMemo(()=>{const t={};return W.forEach(n=>{const s=n.event_id;t[s]||(t[s]=[]),t[s].push(n)}),t},[W]),Y=r.useMemo(()=>c.filter(t=>p[t.id]?.length>0),[c,p]),{currentEvents:z,pastEvents:g}=r.useMemo(()=>{const t=new Date;t.setHours(0,0,0,0);const n=[],s=[];return c.forEach(a=>{const o=new Date(a.event_start),i=new Date(a.event_end);o.setHours(0,0,0,0),i.setHours(0,0,0,0),o>=t||i>=t?n.push(a):s.push(a)}),{currentEvents:n,pastEvents:s}},[c]),J=t=>{const n=new Set(A);n.has(t)?n.delete(t):n.add(t),S(n)},me=()=>{const t=new Set(Y.map(n=>n.id));S(t)},ue=()=>{S(new Set)},he=r.useMemo(()=>[{name:"event_id",label:"Event",type:"select",options:c.filter(t=>t.is_active).map(t=>({value:t.id,label:`${t.event_name} - ${t.event_type}`})),required:!0},{name:"contestant_name",label:"Contestant Name",type:"text",required:!0,placeholder:"Enter contestant name"},{name:"sequence_no",label:"Sequence No",type:"number",required:!0,placeholder:"Contestant sequence number"},{name:"is_active",label:"Status",type:"select",options:[{value:"1",label:"Active"},{value:"0",label:"Inactive"}],required:!0}],[c]),pe=r.useMemo(()=>[{name:"event_id",label:"Event",type:"select",options:c.filter(t=>t.is_active).map(t=>({value:t.id,label:`${t.event_name} - ${t.event_type}`})),required:!0},{name:"contestant_name",label:"Contestant Name",type:"text",required:!0,placeholder:"Enter contestant name"},{name:"sequence_no",label:"Sequence No",type:"number",required:!0,placeholder:"Contestant sequence number"},{name:"is_active",label:"Status",type:"select",options:[{value:"1",label:"Active"},{value:"0",label:"Inactive"}],required:!0}],[c]),ge=r.useMemo(()=>[{name:"photo",label:"Contestant Photo",type:"file",required:!0,accept:"image/*",placeholder:"Select contestant photo"}],[]),fe=()=>{w({event_id:"",contestant_name:"",sequence_no:"",is_active:"1"}),R(!0)},ye=()=>{R(!1),w({})},K=t=>{L(t),C({event_id:t.event_id?.toString()||"",contestant_name:t.contestant_name||"",sequence_no:t.sequence_no?.toString()||"",is_active:t.is_active?.toString()||"1"}),I(!0)},O=()=>{I(!1),L(null),C({})},Q=t=>{G(t),E({photo:null}),H(!0)},V=()=>{H(!1),G(null),E({photo:null})},be=t=>{w(t)},je=t=>{C(t)},ve=t=>{E(t)},f=async()=>{try{const t=await fetch("/getEvents?per_page=100&show_past=true"),n=await fetch("/getContestants");if(t.ok){const s=await t.json();let a=[];s&&Array.isArray(s.data)?a=s.data:Array.isArray(s)?a=s:s&&Array.isArray(s.events)&&(a=s.events),j(a)}if(n.ok){const s=await n.json();let a=[];Array.isArray(s)?a=s:s&&Array.isArray(s.contestants)?a=s.contestants:s&&Array.isArray(s.data)&&(a=s.data),v(a)}}catch(t){console.error("Error refetching data:",t)}},Ne=t=>new Promise((n,s)=>{u(!0),console.log("Adding contestant with data:",t),y.post("/addContestants",t,{onSuccess:()=>{l("success","Contestant added successfully!"),f(),n()},onError:a=>{console.error(a),l("error","Failed to add contestant"),s(a)},onFinish:()=>{u(!1)}})}),we=t=>new Promise((n,s)=>{u(!0),console.log("Updating contestant with data:",t),y.patch(`/contestants/${x.id}`,t,{onSuccess:()=>{l("success","Contestant updated successfully"),f(),O(),n()},onError:a=>{console.error("Update error:",a),l("error","Failed to update contestant"),s(a)},onFinish:()=>u(!1)})}),Ce=t=>new Promise((n,s)=>{N(!0);const o=document.querySelector('input[type="file"][name="photo"]')?.files[0];if(!o)return l("error","Please select a photo file"),N(!1),s(new Error("No file selected"));const i=new FormData;i.append("photo",o),y.post(`/contestants/${h.id}/upload-photo`,i,{onSuccess:()=>{l("success","Photo uploaded successfully!"),f(),V(),n()},onError:d=>{console.error(d),l("error","Failed to upload photo"),s(d)},onFinish:()=>{N(!1)}})}),X=async t=>{await Fe("Are you sure?","This will delete the contestant permanently!","Yes, delete it")&&y.delete(`/deleteContestant/${t}`,{onSuccess:()=>{l("success","Contestant deleted successfully"),f()},onError:()=>l("error","Failed to delete contestant")})},F=t=>t?e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Active"}):e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"Inactive"}),Z=t=>{const s={Pageant:{color:"bg-pink-100 text-pink-800"},Singing:{color:"bg-indigo-100 text-indigo-800"},Dancing:{color:"bg-orange-100 text-orange-800"}}[t]||{color:"bg-gray-100 text-gray-800"};return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${s.color}`,children:t?t.charAt(0).toUpperCase()+t.slice(1):"Unknown"})},Ee=t=>{if(t){const n=`/storage/${t}`;return e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:n,alt:"Contestant",className:"w-16 h-20 object-cover rounded-lg border border-gray-200 shadow-sm",onError:s=>{s.target.style.display="none",s.target.nextSibling.style.display="flex"}}),e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 rounded-lg transition-all duration-200"})]})}return e.jsxs("div",{className:"w-16 h-20 rounded-lg bg-gray-100 border border-gray-200 flex flex-col items-center justify-center text-gray-400",children:[e.jsx(Se,{className:"w-6 h-6 mb-1"}),e.jsx("span",{className:"text-xs",children:"No Photo"})]})};return ne?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):M?e.jsx("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("div",{className:"text-red-600 mb-4",children:[e.jsx(b,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Error Loading Data"}),e.jsx("p",{className:"text-sm mt-1",children:M})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-150",children:"Retry"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{}),e.jsxs("div",{className:"flex items-center space-x-2",children:[Y.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:me,className:"inline-flex items-center px-3 py-1 border border-gray-300 rounded text-xs font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Expand All"}),e.jsx("button",{onClick:ue,className:"inline-flex items-center px-3 py-1 border border-gray-300 rounded text-xs font-medium text-gray-700 bg-white hover:bg-gray-50",children:"Collapse All"})]}),e.jsxs(_e,{onClick:fe,children:[e.jsx(Ae,{className:"mr-2"}),"Add Contestant"]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"bg-white",children:z.length===0&&g.length===0?e.jsx("div",{className:"px-4 py-6 text-center text-sm text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(b,{className:"w-10 h-10 text-gray-300 mb-2"}),e.jsx("p",{children:"No contestants found"}),e.jsx("p",{className:"text-xs mt-1",children:"Get started by creating a new contestant"})]})}):e.jsxs(e.Fragment,{children:[z.map(t=>{const n=p[t.id]||[],s=A.has(t.id);return e.jsxs("div",{className:"border-b border-gray-200 last:border-b-0",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-50 hover:bg-gray-100 cursor-pointer transition-colors duration-150",onClick:()=>J(t.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[s?e.jsx(k,{className:"w-4 h-4 text-gray-500 mr-2"}):e.jsx(P,{className:"w-4 h-4 text-gray-500 mr-2"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center bg-blue-100 rounded-full",children:e.jsx(ee,{className:"w-4 h-4 text-blue-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.event_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[t.event_type," • ",n.length," contestants"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[Z(t.event_type),F(t.is_active)]})]})}),s&&e.jsx("div",{className:"bg-gray-25",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"No."}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Photo"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contestant Name"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sequence No."}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:n.map((a,o)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:o+1}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:Ee(a.photo)}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:a.contestant_name})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:a.sequence_no}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:F(a.is_active)}),e.jsx("td",{className:"px-6 py-4 text-right whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsxs("button",{onClick:()=>Q(a),className:"inline-flex items-center px-3 py-1 border border-blue-300 rounded text-xs font-medium text-blue-700 bg-blue-50 hover:bg-blue-100 focus:outline-none focus:ring-1 focus:ring-blue-500 transition-colors duration-150",children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),"Upload Photo"]}),e.jsxs("button",{onClick:()=>K(a),className:"inline-flex items-center px-3 py-1 border border-gray-300 rounded text-xs font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-1 focus:ring-blue-500 transition-colors duration-150",children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),"Edit"]}),e.jsxs("button",{onClick:()=>X(a.id),className:"inline-flex items-center px-3 py-1 border border-transparent rounded text-xs font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-1 focus:ring-red-500 transition-colors duration-150",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),"Delete"]})]})})]},a.id))})]})})]},t.id)}),g.length>0&&e.jsxs("div",{className:"border-t-4 border-gray-300",children:[e.jsxs("button",{onClick:()=>xe(!_),className:"w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 flex items-center justify-between transition-colors",children:[e.jsxs("span",{className:"text-sm font-semibold text-gray-700",children:["Past Events (",g.length,")"]}),_?e.jsx(k,{className:"w-4 h-4 text-gray-600"}):e.jsx(P,{className:"w-4 h-4 text-gray-600"})]}),_&&g.map(t=>{const n=p[t.id]||[],s=A.has(t.id);return e.jsxs("div",{className:"border-b border-gray-200 last:border-b-0 bg-gray-50",children:[e.jsx("div",{className:"px-4 py-3 bg-gray-100 hover:bg-gray-200 cursor-pointer transition-colors duration-150 opacity-75",onClick:()=>J(t.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[s?e.jsx(k,{className:"w-4 h-4 text-gray-500 mr-2"}):e.jsx(P,{className:"w-4 h-4 text-gray-500 mr-2"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center bg-gray-300 rounded-full",children:e.jsx(ee,{className:"w-4 h-4 text-gray-600"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-700",children:t.event_name}),e.jsxs("div",{className:"text-sm text-gray-500",children:[t.event_type," • ",n.length," contestants"]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[Z(t.event_type),F(t.is_active)]})]})}),s&&e.jsx("div",{className:"overflow-x-auto bg-gray-50",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-300",children:[e.jsx("thead",{className:"bg-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Contestant Details"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Sequence #"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Photo"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-right text-xs font-medium text-gray-600 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-gray-50 divide-y divide-gray-300",children:n.map(a=>e.jsxs("tr",{className:"hover:bg-gray-100 transition-colors duration-150",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 w-8 h-8 flex items-center justify-center bg-gray-400 rounded-full",children:e.jsx(b,{className:"w-4 h-4 text-gray-600"})}),e.jsx("div",{className:"ml-3",children:e.jsx("div",{className:"text-sm font-medium text-gray-700",children:a.contestant_name})})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-300 text-gray-700",children:["#",a.sequence_no]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center",children:[a.photo?e.jsx("img",{src:`/storage/${a.photo}`,alt:a.contestant_name,className:"w-10 h-10 rounded-full object-cover border border-gray-300"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center",children:e.jsx(b,{className:"w-5 h-5 text-gray-500"})}),e.jsxs("button",{onClick:()=>Q(a),className:"ml-2 inline-flex items-center px-2 py-1 text-xs text-gray-700 bg-white border border-gray-300 rounded hover:bg-gray-50",children:[e.jsx(te,{className:"w-3 h-3 mr-1"}),a.photo?"Change":"Upload"]})]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsxs("button",{onClick:()=>K(a),className:"inline-flex items-center px-2 py-1 border border-transparent rounded text-xs font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-1 focus:ring-blue-500 transition-colors duration-150",children:[e.jsx(se,{className:"w-3 h-3 mr-1"}),"Edit"]}),e.jsxs("button",{onClick:()=>X(a.id),className:"inline-flex items-center px-2 py-1 border border-transparent rounded text-xs font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-1 focus:ring-red-500 transition-colors duration-150",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),"Delete"]})]})})]},a.id))})]})})]},t.id)})]})]})})})]}),e.jsx(D,{show:T,onClose:ye,title:"Add Contestant",fields:he,onSubmit:Ne,submitText:m?"Adding...":"Add Contestant",processing:m,formData:le,onFormChange:be},`add-contestant-${T}`),e.jsx(D,{show:oe,onClose:O,title:`Editing - ${x?x.contestant_name:""}`,initialData:x,fields:pe,onSubmit:we,submitText:m?"Saving...":"Save Changes",processing:m,formData:ce,onFormChange:je},`edit-contestant-${x?.id||"none"}`),e.jsx(D,{show:ie,onClose:V,title:`Upload Photo - ${h?h.contestant_name:""}`,fields:ge,onSubmit:Ce,submitText:B?"Uploading...":"Upload Photo",processing:B,formData:de,onFormChange:ve},`upload-photo-${h?.id||"none"}`)]})}export{Te as default};
