import{c as V,r,j as e,H as P}from"./app-B4mixU04.js";import{D as f,T as X}from"./index-fa5S-pAV.js";import G from"./Table-CH7ANMu4.js";import{A as F}from"./ApplicationLogo-CPOmZZUG.js";import"./transition-8sCOe-Bx.js";import"./iconBase-C617z4Lj.js";import"./printLogo-Dw7oCvxT.js";function q({header:d,children:b,auth:j,onContestantSelect:a,selectedContestant:E}){console.log("ðŸŽ¯ JudgeLayout rendering");const{props:B}=V(),x=(j||B.auth).user;console.log("ðŸ‘¤ User ID:",x?.id),console.log("ðŸŒ Window.Echo exists:",!!window.Echo);const[p,v]=r.useState(!1),[n,L]=r.useState(null),[R,_]=r.useState(!0),[S,T]=r.useState(null),[N,Q]=r.useState(null),[w,M]=r.useState(null),[O,y]=r.useState(!1),m=r.useRef(0),D=2e3,U=()=>{v(!p)},k=r.useCallback(async(t=null,i=!1)=>{const o=Date.now();if(!i&&o-m.current<D)return console.log("âš¡ Using cached data (fetch cooldown active)"),n;try{_(!0);const s=t?`/judge/tabulation-data?round_no=${t}`:"/judge/tabulation-data",l=await fetch(s);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const c=await l.json();if(c.success)return L(c.data),m.current=o,c.data;throw new Error(c.error||"Failed to fetch tabulation data")}catch(s){return console.error("Error fetching tabulation data:",s),T(s.message),null}finally{_(!1)}},[n]);r.useEffect(()=>{k()},[]),r.useEffect(()=>()=>{window.Echo&&N&&window.Echo.leave(N)},[N]),r.useEffect(()=>{if(!x?.id)return;console.log("ðŸ”§ Setting up judge notification listener for user:",x.id);const t=`judge-notifications.${x.id}`;if(!window.Echo){console.error("âŒ window.Echo not available");return}console.log("ðŸ“¡ Subscribing to private channel:",t);const i=window.Echo.private(t);if(window.Echo.connector&&window.Echo.connector.pusher){const o=window.Echo.connector.pusher;console.log("ðŸ”Œ Pusher connection state:",o.connection.state),o.connection.bind("connected",()=>{console.log("âœ… Pusher connected")}),o.connection.bind("error",s=>{console.error("âŒ Pusher connection error:",s)})}return i.listen(".judge.notification",o=>{console.log("ðŸ”” NOTIFICATION RECEIVED!",o),M(o.notification),y(!0),setTimeout(()=>{y(!1)},3e4)}),console.log("âœ… Judge notification listener set up on:",t),()=>{console.log("ðŸ§¹ Cleanup: leaving channel:",t),window.Echo.leave(t)}},[x?.id]);const z=t=>t?t.startsWith("http")?t:t.startsWith("contestants/")?`/storage/${t}`:`/storage/${t}`:"/default-candidate.jpg",C=()=>{T(null),k()},g=n?.contestants||[],h=n?.active_round?.round_no,u=n?.viewing_round?.round_no||h,$=n?.available_rounds||[],W=n?.is_locked||!1;n?.event?.event_name;const H=r.useCallback(async t=>{if(Date.now()-m.current<D&&n){console.log("âš¡ Fast navigation - using cached data");const s=n.contestants?.find(l=>l.id===t.id);if(a&&s){a(s);return}}if(a){const s=n?.contestants?.find(l=>l.id===t.id)||t;a(s)}try{const s=u&&u!==h?`/judge/tabulation-data?round_no=${u}`:"/judge/tabulation-data",l=await fetch(s);if(l.ok){const c=await l.json();if(c.success){L(c.data),m.current=Date.now();const A=c.data.contestants?.find(J=>J.id===t.id);a&&A&&a(A)}}}catch(s){console.error("Error refreshing contestant data:",s)}},[a,u,h,n]),I=t=>{k(t),a&&a(null)};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsxs("div",{className:"hidden md:flex md:flex-col w-[500px] bg-white border-r border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 border-b border-gray-200",children:[e.jsx(F,{className:"block h-10 w-auto fill-current text-gray-900"}),e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"SFXC"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Tabulation System"})]}),e.jsx("button",{onClick:C,className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",title:"Refresh data",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]})})]}),$.length>0&&e.jsxs("div",{className:"p-4 border-b border-gray-200 bg-gray-50",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-700 mb-2",children:"SELECT ROUND"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{value:u,onChange:t=>I(Number(t.target.value)),className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 text-sm font-medium",children:$.map(t=>e.jsxs("option",{value:t.round_no,children:["Round ",t.round_no," ",t.is_active?"(Active)":""]},t.id))}),W&&e.jsxs("div",{className:"flex items-center gap-1 px-3 py-2 bg-red-100 text-red-800 rounded-lg text-xs font-semibold",children:[e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),e.jsx("span",{children:"Locked"})]})]}),W&&e.jsx("p",{className:"text-xs text-red-600 mt-2",children:"This round is from a previous round. Scores cannot be modified."})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"p-6",children:R?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading contestants..."}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"Real-time updates enabled"})]}):S?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-lg text-gray-700 mb-3 font-semibold",children:"Waiting for Contestants"}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"The event is not ready yet. Please wait for the admin to set up contestants and activate the round."}),e.jsx("button",{onClick:C,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors",children:"Refresh"})]}):g.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"})})}),e.jsx("p",{className:"text-xl text-gray-500 mb-2",children:"No contestants available"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Waiting for admin to populate this round..."}),e.jsx("p",{className:"text-xs text-gray-400 mt-2",children:"Real-time updates are enabled"})]}):e.jsx("div",{className:"space-y-6",children:g.map(t=>e.jsxs("div",{className:`flex items-center gap-6 p-6 rounded-2xl border-2 transition-all duration-200 cursor-pointer shadow-lg transform hover:scale-[1.02] ${E?.id===t.id?"border-green-500 bg-green-50 shadow-green-200":"border-gray-200 hover:border-green-400 hover:bg-green-50"}`,onClick:()=>H(t),children:[e.jsx("div",{className:"relative flex-shrink-0",children:e.jsx("img",{src:z(t.photo),alt:t.contestant_name,className:"w-32 h-32 rounded-full object-cover border-4 border-gray-300 shadow-2xl",onError:i=>{i.target.src="/default-candidate.jpg"}})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-2xl font-bold text-gray-900 truncate mb-2",children:t.contestant_name})})]},t.id))})})})]}),p&&e.jsx("div",{className:"fixed inset-0 z-40 bg-gray-900 bg-opacity-50 md:hidden transition-opacity",onClick:()=>v(!1)}),e.jsxs("div",{className:`fixed inset-y-0 left-0 z-50 w-[90vw] bg-white border-r border-gray-200 transform transition-transform duration-300 ease-in-out md:hidden ${p?"translate-x-0":"-translate-x-full"}`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{className:"block h-8 w-auto fill-current text-gray-900"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"SFXC"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Contestants"}),h&&e.jsx("div",{className:"mt-1",children:e.jsxs("span",{className:"inline-block px-2 py-1 bg-green-100 text-green-800 text-xs font-bold rounded",children:["Round ",h]})})]})]}),e.jsx("button",{onClick:()=>v(!1),className:"p-2 rounded-lg text-gray-500 hover:bg-gray-100 hover:text-gray-700 transition-colors",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("div",{className:"text-center mb-6",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Contestants"})}),R?e.jsx("div",{className:"flex justify-center py-16",children:e.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-green-600"})}):S?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("p",{className:"text-base text-red-600 mb-3",children:"Failed to load contestants"}),e.jsx("button",{onClick:C,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium",children:"Retry"})]}):g.length===0?e.jsx("div",{className:"text-center py-16",children:e.jsx("p",{className:"text-lg text-gray-500",children:"No contestants available"})}):e.jsx("div",{className:"space-y-4",children:g.map(t=>e.jsxs("div",{className:`flex items-center gap-4 p-4 rounded-xl border-2 transition-all cursor-pointer ${E?.id===t.id?"border-green-500 bg-green-50":"border-gray-200 hover:border-green-300 hover:bg-green-50"}`,onClick:()=>H(t),children:[e.jsx("div",{className:"relative flex-shrink-0",children:e.jsx("img",{src:z(t.photo),alt:t.contestant_name,className:"w-20 h-20 rounded-full object-cover border-4 border-gray-200",onError:i=>{i.target.src="/default-candidate.jpg"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xl font-bold text-gray-900 truncate",children:t.contestant_name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Score: ",t.total_score]})]})]},t.id))})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx("header",{className:"bg-gradient-to-r from-green-700 to-green-800 shadow-md z-10",children:e.jsxs("div",{className:"flex items-center justify-between px-4 sm:px-6 lg:px-8 h-16",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:U,className:"md:hidden p-2 rounded-lg text-white/80 hover:bg-white/10 hover:text-white transition-colors",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h16M4 18h16"})})}),d&&e.jsx("div",{children:typeof d=="string"?e.jsx("h1",{className:"text-xl font-bold text-white",children:d}):e.jsx("div",{className:"text-xl font-bold text-white",children:d})})]}),e.jsx("div",{children:e.jsxs(f,{children:[e.jsx(f.Trigger,{children:e.jsx("span",{className:"inline-flex rounded-md",children:e.jsx("button",{type:"button",className:"inline-flex items-center p-1.5 border-transparent rounded-lg text-white/80 hover:bg-white/10 transition-colors",children:e.jsx("img",{src:x.picture?`/storage/profile-pictures/${x.picture}`:"/default-avatar.png",alt:"Profile",className:"w-8 h-8 rounded-full object-cover border-2 border-white"})})})}),e.jsx(f.Content,{children:e.jsxs(f.Link,{className:"flex items-center hover:text-red-600",href:route("logout"),method:"post",as:"button",children:[e.jsx(X,{className:"mr-2",size:16}),"Log Out"]})})]})})]})}),e.jsx("main",{className:"flex-1 overflow-hidden bg-gray-50",children:b})]}),O&&w&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4 animate-bounce-in",children:[e.jsxs("div",{className:"bg-red-500 text-white px-6 py-4 rounded-t-lg flex items-center gap-3",children:[e.jsx("svg",{className:"w-8 h-8 animate-pulse",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{d:"M10 2a6 6 0 00-6 6v3.586l-.707.707A1 1 0 004 14h12a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z"})}),e.jsx("h3",{className:"text-xl font-bold",children:"Admin Notification"})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"bg-red-50 border-l-4 border-red-500 p-4 mb-6",children:e.jsx("p",{className:"text-gray-800 font-medium text-lg",children:w.message})}),e.jsx("div",{className:"text-xs text-gray-500 mb-4",children:w.timestamp}),e.jsx("button",{onClick:()=>{y(!1),M(null)},className:"w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg transition-colors",children:"Got it!"})]})]})})]})}function ae(){const[d,b]=r.useState(null),j=r.useCallback(a=>{b(a)},[]);return e.jsxs(q,{header:e.jsx("h2",{className:"text-xl font-semibold leading-tight text-white-800"}),selectedContestant:d,onContestantSelect:j,children:[e.jsx(P,{title:"Dashboard"}),e.jsx("div",{className:"py-5",children:e.jsx(G,{selectedContestant:d})})]})}export{ae as default};
