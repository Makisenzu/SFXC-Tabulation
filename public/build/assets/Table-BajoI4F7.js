import{r as c,a as w,j as e,R as F}from"./app-C6MKZYWX.js";import{a as q}from"./printLogo-Dw7oCvxT.js";const L=F.memo(({photo:a,name:d,getPhotoUrl:o})=>e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx("img",{src:o(a),alt:d,className:"w-48 h-64 object-cover border-2 border-gray-400 shadow-lg rounded mb-4",loading:"eager",decoding:"async",onError:i=>{i.target.src="/default-candidate.jpg"}}),e.jsx("div",{className:"text-2xl text-black font-bold mt-2",children:d})]})),z=({selectedContestant:a})=>{const[d,o]=c.useState({}),[i,m]=c.useState([]),[V,f]=c.useState(null),[y,v]=c.useState(!1),[S,g]=c.useState(!1),[p,j]=c.useState(!1),x=c.useRef({}),h=c.useRef(null),b=c.useCallback(t=>t?t.startsWith("http")?t:t.startsWith("contestants/")?`/storage/${t}`:`/storage/${t}`:"/default-candidate.jpg",[]);c.useEffect(()=>{if(a?.photo){const t=new Image;t.src=b(a.photo)}},[a?.photo,b]);const u=c.useCallback(async(t,r,l)=>{try{g(!0),await w.patch("/judge/update-score",{criteria_id:t,score:r===""?0:parseFloat(r),tabulation_id:l,contestant_id:a?.id,round_id:a?.round_id},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{x.current[t]=r},onError:s=>{throw new Error(s.message||"Failed to update score")}})}catch(s){throw s}finally{g(!1)}},[a]),N=c.useCallback((t,r,l)=>{h.current&&clearTimeout(h.current),x.current[t]!==r&&(h.current=setTimeout(()=>{u(t,r,l)},500))},[u]);c.useEffect(()=>{if(a){const t=setTimeout(()=>{if(a.criteria&&a.criteria.length>0){m(a.criteria);const r={};a.criteria.forEach(l=>{const s=l.score||"";r[l.id]=s,x.current[l.id]=s}),o(r)}else console.log("ðŸ”´ No criteria found in contestant data"),m([]);a.round_id&&f({id:a.round_id,round_number:a.round_number||1}),v(!1)},0);return()=>clearTimeout(t)}else m([]),o({}),f(null),x.current={}},[a?.id]);const k=c.useCallback((t,r,l)=>{if(r===""||/^\d*\.?\d{0,2}$/.test(r)){const s=parseFloat(r);(r===""||s>=0&&s<=10)&&(o(n=>({...n,[t]:r})),N(t,r,l))}},[N]),E=c.useCallback(async(t,r,l)=>{let s=r;if(r&&r!==""){const n=parseFloat(r);isNaN(n)||(s=Math.min(10,Math.max(0,n)).toFixed(2),o(T=>({...T,[t]:s})))}else s="",o(n=>({...n,[t]:s}));h.current&&clearTimeout(h.current),x.current[t]!==s&&await u(t,s,l)},[u]);c.useEffect(()=>{const t=async()=>{if(!i||i.length===0)return;const r=[];if(i.forEach(l=>{const s=d[l.id],n=x.current[l.id];s!==void 0&&s!==n&&r.push(u(l.id,s,l.tabulation_id))}),r.length>0)try{await Promise.all(r)}catch{}};a&&i.length>0&&t()},[a,i,d,u]);const R=(t,r)=>{if(!t||t==="")return"0.00";const l=parseInt(r)/100;return(parseFloat(t)/10*l*100).toFixed(2)},_=async()=>{try{j(!0),(await w.post("/judge/request-help")).data.success?alert("Help request sent to admin successfully!"):alert("Help request may not have been sent properly.")}catch{alert("Failed to send help request. Please try again.")}finally{j(!1)}};return e.jsxs("div",{className:"h-full w-full bg-white",children:[e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx("button",{onClick:_,disabled:p,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded shadow-lg flex items-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed border-2 border-red-600 text-lg",children:p?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Sending..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"Request Help"})]})})}),a?e.jsx("div",{className:"h-full w-full bg-white",children:y?e.jsx("div",{className:"flex justify-center items-center h-full bg-white",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-gray-300 border-t-black"}),e.jsx("p",{className:"text-xl font-bold text-black",children:"Loading scoring sheet..."})]})}):e.jsx("div",{className:"h-full w-full overflow-auto",children:e.jsxs("table",{className:"w-full h-full border-collapse",children:[e.jsx("thead",{className:"bg-white sticky top-0 z-10 border-b-4 border-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center p-4 border-2 border-gray-400 font-bold text-xl",style:{width:"25%"},children:"CONTESTANT"}),e.jsx("th",{className:"text-center p-4 border-2 border-gray-400 font-bold text-xl",style:{width:"45%"},children:"CRITERIA"}),e.jsx("th",{className:"text-center p-4 border-2 border-gray-400 font-bold text-xl",style:{width:"15%"},children:"SCORE (0-10)"}),e.jsx("th",{className:"text-center p-4 border-2 border-gray-400 font-bold text-xl",style:{width:"15%"},children:"% EQUIVALENT"})]})}),e.jsx("tbody",{className:"bg-white",children:i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center p-16 text-xl border-2 border-gray-400 h-full font-bold",children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:e.jsx("p",{children:"No criteria available for this contestant."})})})}):i.map((t,r)=>{const l=d[t.id],s=R(l,t.percentage);return e.jsxs("tr",{children:[r===0&&e.jsx("td",{className:"text-center p-4 align-middle border-2 border-gray-400 bg-white",rowSpan:i.length,style:{verticalAlign:"middle",height:"100%"},children:e.jsx(L,{photo:a.photo,name:a.contestant_name,getPhotoUrl:b})}),e.jsx("td",{className:"p-4 align-middle border-2 border-gray-400 bg-white",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-bold text-black text-xl mb-2",children:t.criteria_desc}),t.definition&&e.jsx("div",{className:"text-base text-black mt-2",children:t.definition}),e.jsx("div",{className:"inline-flex items-center gap-2 mt-2 border-2 border-gray-400 px-3 py-1 rounded font-bold text-sm",children:e.jsxs("span",{children:["Weight: ",t.percentage,"%"]})})]})}),e.jsx("td",{className:"text-center p-4 align-middle border-2 border-gray-400 bg-white",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:l||"",onChange:n=>k(t.id,n.target.value,t.tabulation_id),onBlur:n=>E(t.id,n.target.value,t.tabulation_id),className:"w-32 text-3xl font-bold text-black text-center border-2 border-gray-400 rounded p-2 focus:border-gray-600 focus:outline-none transition-all bg-white",placeholder:"0.00",maxLength:5}),S&&e.jsx("div",{className:"absolute -top-2 -right-2 border-2 border-gray-400 bg-white text-black text-xs px-2 py-1 rounded font-bold",children:"Saving"})]}),e.jsx("div",{className:"text-xs text-black font-semibold",children:"Range: 0.00 - 10.00"})]})}),e.jsx("td",{className:"text-center p-4 align-middle border-2 border-gray-400 bg-white",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"border-2 border-gray-400 px-4 py-2 rounded font-bold",children:e.jsxs("span",{className:"text-3xl",children:[s,"%"]})}),e.jsx("div",{className:"text-xs text-black font-semibold mt-1",children:"Weighted Score"})]})})]},t.id)})})]})})}):e.jsx("div",{className:"h-full w-full flex items-center justify-center bg-white",children:e.jsxs("div",{className:"flex flex-col items-center text-center bg-white p-12 rounded",children:[e.jsx("div",{className:"p-5 rounded mb-6",children:e.jsx("img",{src:q,alt:"App Logo",className:"h-24 w-auto"})}),e.jsx("h3",{className:"text-4xl font-bold text-black mb-3",children:"No Contestant Selected"}),e.jsx("p",{className:"text-xl text-black font-semibold max-w-md",children:"Please select a contestant from the list to begin scoring"})]})})]})};export{z as default};
