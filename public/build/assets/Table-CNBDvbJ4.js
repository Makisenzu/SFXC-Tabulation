import{r as c,a as w,j as e,R as L}from"./app-BFXxh3rB.js";import{a as V}from"./printLogo-Dw7oCvxT.js";const H=L.memo(({photo:r,name:d,getPhotoUrl:i})=>e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx("img",{src:i(r),alt:d,className:"w-48 h-64 object-cover border-2 border-gray-400 shadow-lg rounded mb-4",loading:"eager",decoding:"async",onError:n=>{n.target.src="/default-candidate.jpg"}}),e.jsx("div",{className:"text-2xl text-black font-bold mt-2",children:d})]})),W=({selectedContestant:r})=>{const[d,i]=c.useState({}),[n,b]=c.useState([]),[q,g]=c.useState(null),[y,S]=c.useState(!1),[k,p]=c.useState(!1),[j,N]=c.useState(!1),x=c.useRef({}),m=c.useRef(null),f=c.useCallback(t=>t?t.startsWith("http")?t:t.startsWith("contestants/")?`/storage/${t}`:`/storage/${t}`:"/default-candidate.jpg",[]);c.useEffect(()=>{if(r?.photo){const t=new Image;t.src=f(r.photo)}},[r?.photo,f]);const u=c.useCallback(async(t,s,l)=>{try{p(!0),await w.patch("/judge/update-score",{criteria_id:t,score:s===""?0:parseFloat(s),tabulation_id:l,contestant_id:r?.id,round_id:r?.round_id},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{x.current[t]=s},onError:a=>{throw new Error(a.message||"Failed to update score")}})}catch(a){throw a}finally{p(!1)}},[r]),v=c.useCallback((t,s,l)=>{m.current&&clearTimeout(m.current),x.current[t]!==s&&(m.current=setTimeout(()=>{u(t,s,l)},500))},[u]);c.useEffect(()=>{if(r){const t=setTimeout(()=>{if(r.criteria&&r.criteria.length>0){b(r.criteria);const s={};r.criteria.forEach(l=>{const a=l.score||"";s[l.id]=a,x.current[l.id]=a}),i(s)}else console.log("ðŸ”´ No criteria found in contestant data"),b([]);r.round_id&&g({id:r.round_id,round_number:r.round_number||1}),S(!1)},0);return()=>clearTimeout(t)}else b([]),i({}),g(null),x.current={}},[r?.id]);const _=c.useCallback((t,s,l,a)=>{if(!a&&(s===""||/^\d*\.?\d{0,2}$/.test(s))){const o=parseFloat(s);(s===""||o>=0&&o<=10)&&(i(h=>({...h,[t]:s})),v(t,s,l))}},[v]),R=c.useCallback(async(t,s,l,a)=>{if(a)return;let o=s;if(s&&s!==""){const h=parseFloat(s);isNaN(h)||(o=Math.min(10,Math.max(0,h)).toFixed(2),i(F=>({...F,[t]:o})))}else o="",i(h=>({...h,[t]:o}));m.current&&clearTimeout(m.current),x.current[t]!==o&&await u(t,o,l)},[u]);c.useEffect(()=>{const t=async()=>{if(!n||n.length===0)return;const s=[];if(n.forEach(l=>{const a=d[l.id],o=x.current[l.id];a!==void 0&&a!==o&&s.push(u(l.id,a,l.tabulation_id))}),s.length>0)try{await Promise.all(s)}catch{}};r&&n.length>0&&t()},[r,n,d,u]);const E=(t,s)=>{if(!t||t==="")return"0.00";const l=parseInt(s)/100;return(parseFloat(t)/10*l*100).toFixed(2)},T=async()=>{try{N(!0),(await w.post("/judge/request-help")).data.success?alert("Help request sent to admin successfully!"):alert("Help request may not have been sent properly.")}catch{alert("Failed to send help request. Please try again.")}finally{N(!1)}};return e.jsxs("div",{className:"h-full w-full bg-white",children:[e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx("button",{onClick:T,disabled:j,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded shadow-lg flex items-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed border-2 border-red-600 text-lg",children:j?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Sending..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"Request Help"})]})})}),r?e.jsx("div",{className:"h-full w-full bg-white",children:y?e.jsx("div",{className:"flex justify-center items-center h-full bg-white",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-gray-300 border-t-black"}),e.jsx("p",{className:"text-xl font-bold text-black",children:"Loading scoring sheet..."})]})}):e.jsx("div",{className:"h-full w-full overflow-auto",children:e.jsxs("table",{className:"w-full h-full border-collapse",children:[e.jsx("thead",{className:"bg-white sticky top-0 z-10 border-b-4 border-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center p-4 border-2 border-gray-400 font-bold text-xl",style:{width:"25%"},children:"CONTESTANT"}),e.jsx("th",{className:"text-center p-4 border-2 border-gray-400 font-bold text-xl",style:{width:"45%"},children:"CRITERIA"}),e.jsx("th",{className:"text-center p-4 border-2 border-gray-400 font-bold text-xl",style:{width:"15%"},children:"SCORE (0-10)"}),e.jsx("th",{className:"text-center p-4 border-2 border-gray-400 font-bold text-xl",style:{width:"15%"},children:"% EQUIVALENT"})]})}),e.jsx("tbody",{className:"bg-white",children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center p-16 text-xl border-2 border-gray-400 h-full font-bold",children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:e.jsx("p",{children:"No criteria available for this contestant."})})})}):n.map((t,s)=>{const l=d[t.id],a=E(l,t.percentage);return e.jsxs("tr",{children:[s===0&&e.jsx("td",{className:"text-center p-4 align-middle border-2 border-gray-400 bg-white",rowSpan:n.length,style:{verticalAlign:"middle",height:"100%"},children:e.jsx(H,{photo:r.photo,name:r.contestant_name,getPhotoUrl:f})}),e.jsx("td",{className:"p-4 align-middle border-2 border-gray-400 bg-white",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-bold text-black text-xl mb-2",children:t.criteria_desc}),t.definition&&e.jsx("div",{className:"text-base text-black mt-2",children:t.definition}),e.jsx("div",{className:"inline-flex items-center gap-2 mt-2 border-2 border-gray-400 px-3 py-1 rounded font-bold text-sm",children:e.jsxs("span",{children:["Weight: ",t.percentage,"%"]})})]})}),e.jsx("td",{className:"text-center p-4 align-middle border-2 border-gray-400 bg-white",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:l||"",onChange:o=>_(t.id,o.target.value,t.tabulation_id,t.is_lock),onBlur:o=>R(t.id,o.target.value,t.tabulation_id,t.is_lock),disabled:t.is_lock,className:`w-32 text-3xl font-bold text-black text-center border-2 border-gray-400 rounded p-2 focus:border-gray-600 focus:outline-none transition-all ${t.is_lock?"bg-gray-100 cursor-not-allowed opacity-60":"bg-white"}`,placeholder:"0.00",maxLength:5}),t.is_lock&&e.jsxs("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs px-2 py-1 rounded font-bold flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),"Locked"]}),k&&!t.is_lock&&e.jsx("div",{className:"absolute -top-2 -right-2 border-2 border-gray-400 bg-white text-black text-xs px-2 py-1 rounded font-bold",children:"Saving"})]}),e.jsx("div",{className:"text-xs text-black font-semibold",children:t.is_lock?"Score Locked":"Range: 0.00 - 10.00"})]})}),e.jsx("td",{className:"text-center p-4 align-middle border-2 border-gray-400 bg-white",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"border-2 border-gray-400 px-4 py-2 rounded font-bold",children:e.jsxs("span",{className:"text-3xl",children:[a,"%"]})}),e.jsx("div",{className:"text-xs text-black font-semibold mt-1",children:"Weighted Score"})]})})]},t.id)})})]})})}):e.jsx("div",{className:"h-full w-full flex items-center justify-center bg-white",children:e.jsxs("div",{className:"flex flex-col items-center text-center bg-white p-12 rounded",children:[e.jsx("div",{className:"p-5 rounded mb-6",children:e.jsx("img",{src:V,alt:"App Logo",className:"h-24 w-auto"})}),e.jsx("h3",{className:"text-4xl font-bold text-black mb-3",children:"No Contestant Selected"}),e.jsx("p",{className:"text-xl text-black font-semibold max-w-md",children:"Please select a contestant from the list to begin scoring"})]})})]})};export{W as default};
