import{r as o,a as w,j as e,R as L}from"./app-CIBWa0BM.js";import{a as V}from"./printLogo-Dw7oCvxT.js";const H=L.memo(({photo:l,name:x,getPhotoUrl:i})=>e.jsxs("div",{className:"flex flex-col items-center justify-center h-full",children:[e.jsx("img",{src:i(l),alt:x,className:"w-48 h-64 object-cover border-2 border-gray-400 shadow-lg rounded mb-4",loading:"eager",decoding:"async",onError:n=>{n.target.src="/default-candidate.jpg"}}),e.jsx("div",{className:"text-2xl text-black font-bold mt-2",children:x})]})),W=({selectedContestant:l})=>{const[x,i]=o.useState({}),[n,f]=o.useState([]),[q,p]=o.useState(null),[S,b]=o.useState(!1),[k,j]=o.useState(!1),[N,y]=o.useState(!1),u=o.useRef({}),d=o.useRef(null),g=o.useCallback(t=>t?t.startsWith("http")?t:t.startsWith("contestants/")?`/storage/${t}`:`/storage/${t}`:"/default-candidate.jpg",[]);o.useEffect(()=>{if(l?.photo){const t=new Image;t.src=g(l.photo)}},[l?.photo,g]);const h=o.useCallback(async(t,r,a)=>{try{j(!0),await w.patch("/judge/update-score",{criteria_id:t,score:r===""?0:parseFloat(r),tabulation_id:a,contestant_id:l?.id,round_id:l?.round_id},{preserveScroll:!0,preserveState:!0,onSuccess:()=>{u.current[t]=r},onError:s=>{throw new Error(s.message||"Failed to update score")}})}catch(s){throw s}finally{j(!1)}},[l]),v=o.useCallback((t,r,a)=>{d.current&&clearTimeout(d.current),u.current[t]!==r&&(d.current=setTimeout(()=>{h(t,r,a)},500))},[h]);o.useEffect(()=>{if(l){b(!0),d.current&&(clearTimeout(d.current),d.current=null);const t=setTimeout(()=>{if(l.criteria&&l.criteria.length>0){f(l.criteria);const r={};l.criteria.forEach(a=>{let s=a.score||"";if(typeof s=="number"&&(s=s===0?"":s.toFixed(2)),typeof s=="string"&&s!==""&&s!=="0"&&s!=="0.00"){const c=parseFloat(s);!isNaN(c)&&c>0?s=c.toFixed(2):s=""}else(s==="0"||s==="0.00")&&(s="");r[a.id]=s,u.current[a.id]=s}),i(r)}else console.log("ðŸ”´ No criteria found in contestant data"),f([]),i({});l.round_id&&p({id:l.round_id,round_number:l.round_number||1}),b(!1)},0);return()=>clearTimeout(t)}else f([]),i({}),p(null),u.current={},b(!1)},[l?.id]);const _=o.useCallback((t,r,a,s)=>{if(!s&&(r===""||/^\d*\.?\d{0,2}$/.test(r))){const c=parseFloat(r);(r===""||c>=0&&c<=10)&&(i(m=>({...m,[t]:r})),v(t,r,a))}},[v]),R=o.useCallback(async(t,r,a,s)=>{if(s)return;let c=r;if(r&&r!==""){const m=parseFloat(r);isNaN(m)||(c=Math.min(10,Math.max(0,m)).toFixed(2),i(T=>({...T,[t]:c})))}else c="",i(m=>({...m,[t]:c}));d.current&&clearTimeout(d.current),u.current[t]!==c&&await h(t,c,a)},[h]);o.useEffect(()=>{const t=async()=>{if(!n||n.length===0)return;const r=[];if(n.forEach(a=>{const s=x[a.id],c=u.current[a.id];s!==void 0&&s!==c&&r.push(h(a.id,s,a.tabulation_id))}),r.length>0)try{await Promise.all(r)}catch{}};l&&n.length>0&&t()},[l,n,x,h]);const E=(t,r)=>{if(!t||t==="")return"0.00";const a=parseInt(r)/100;return(parseFloat(t)/10*a*100).toFixed(2)},F=async()=>{try{y(!0),(await w.post("/judge/request-help")).data.success?alert("Help request sent to admin successfully!"):alert("Help request may not have been sent properly.")}catch{alert("Failed to send help request. Please try again.")}finally{y(!1)}};return e.jsxs("div",{className:"h-full w-full bg-white",children:[e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsx("button",{onClick:F,disabled:N,className:"bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded shadow-lg flex items-center gap-2 transition-all disabled:opacity-50 disabled:cursor-not-allowed border-2 border-red-600 text-lg",children:N?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Sending..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{children:"Request Help"})]})})}),l?e.jsx("div",{className:"h-full w-full bg-white",children:S?e.jsx("div",{className:"flex justify-center items-center h-full bg-white",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-gray-300 border-t-black"}),e.jsx("p",{className:"text-xl font-bold text-black",children:"Loading scoring sheet..."})]})}):e.jsx("div",{className:"h-full w-full overflow-auto",children:e.jsxs("table",{className:"w-full h-full border-collapse",children:[e.jsx("thead",{className:"bg-white sticky top-0 z-10 border-b-4 border-gray-400",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center p-4 border-2 border-gray-400 font-bold text-xl",style:{width:"25%"},children:"CONTESTANT"}),e.jsx("th",{className:"text-center p-4 border-2 border-gray-400 font-bold text-xl",style:{width:"45%"},children:"CRITERIA"}),e.jsx("th",{className:"text-center p-4 border-2 border-gray-400 font-bold text-xl",style:{width:"15%"},children:"SCORE (0-10)"}),e.jsx("th",{className:"text-center p-4 border-2 border-gray-400 font-bold text-xl",style:{width:"15%"},children:"% EQUIVALENT"})]})}),e.jsx("tbody",{className:"bg-white",children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center p-16 text-xl border-2 border-gray-400 h-full font-bold",children:e.jsx("div",{className:"flex flex-col items-center gap-3",children:e.jsx("p",{children:"No criteria available for this contestant."})})})}):n.map((t,r)=>{const a=x[t.id],s=E(a,t.percentage);return e.jsxs("tr",{children:[r===0&&e.jsx("td",{className:"text-center p-4 align-middle border-2 border-gray-400 bg-white",rowSpan:n.length,style:{verticalAlign:"middle",height:"100%"},children:e.jsx(H,{photo:l.photo,name:l.contestant_name,getPhotoUrl:g})}),e.jsx("td",{className:"p-4 align-middle border-2 border-gray-400 bg-white",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"font-bold text-black text-xl mb-2",children:t.criteria_desc}),t.definition&&e.jsx("div",{className:"text-base text-black mt-2",children:t.definition}),e.jsx("div",{className:"inline-flex items-center gap-2 mt-2 border-2 border-gray-400 px-3 py-1 rounded font-bold text-sm",children:e.jsxs("span",{children:["Weight: ",t.percentage,"%"]})})]})}),e.jsx("td",{className:"text-center p-4 align-middle border-2 border-gray-400 bg-white",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:a||"",onChange:c=>_(t.id,c.target.value,t.tabulation_id,t.is_lock),onBlur:c=>R(t.id,c.target.value,t.tabulation_id,t.is_lock),disabled:t.is_lock,className:`w-32 text-3xl font-bold text-black text-center border-2 border-gray-400 rounded p-2 focus:border-gray-600 focus:outline-none transition-all ${t.is_lock?"bg-gray-100 cursor-not-allowed opacity-60":"bg-white"}`,placeholder:"0.00",maxLength:5}),t.is_lock&&e.jsxs("div",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs px-2 py-1 rounded font-bold flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}),"Locked"]}),k&&!t.is_lock&&e.jsx("div",{className:"absolute -top-2 -right-2 border-2 border-gray-400 bg-white text-black text-xs px-2 py-1 rounded font-bold",children:"Saving"})]}),e.jsx("div",{className:"text-xs text-black font-semibold",children:t.is_lock?"Score Locked":"Range: 0.00 - 10.00"})]})}),e.jsx("td",{className:"text-center p-4 align-middle border-2 border-gray-400 bg-white",children:e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"border-2 border-gray-400 px-4 py-2 rounded font-bold",children:e.jsxs("span",{className:"text-3xl",children:[s,"%"]})}),e.jsx("div",{className:"text-xs text-black font-semibold mt-1",children:"Weighted Score"})]})})]},t.id)})})]})})}):e.jsx("div",{className:"h-full w-full flex items-center justify-center bg-white",children:e.jsxs("div",{className:"flex flex-col items-center text-center bg-white p-12 rounded",children:[e.jsx("div",{className:"p-5 rounded mb-6",children:e.jsx("img",{src:V,alt:"App Logo",className:"h-24 w-auto"})}),e.jsx("h3",{className:"text-4xl font-bold text-black mb-3",children:"No Contestant Selected"}),e.jsx("p",{className:"text-xl text-black font-semibold max-w-md",children:"Please select a contestant from the list to begin scoring"})]})})]})};export{W as default};
