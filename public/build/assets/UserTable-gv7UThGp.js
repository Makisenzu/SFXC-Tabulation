import{j as e,r as o,b as S}from"./app-DfNBjzIH.js";import{e as F,f as re,k as ae,l as ne,q as ie,r as oe,c as le,s as de}from"./index-CJa_ot7Q.js";import{F as T}from"./FormModal-8tvpXXiw.js";import{P as ce}from"./PrimaryButton-CC8FrB5M.js";import{s as f,c as me}from"./Sweetalert-DN9DxH_e.js";import"./iconBase-CAJMzL94.js";import"./TextInput-Co9nbS28.js";const xe=({currentPage:a,totalPages:n,onPageChange:x})=>{if(n<=1)return null;const b=(()=>{const c=[];let h=Math.max(1,a-Math.floor(2.5)),u=Math.min(n,h+5-1);u-h+1<5&&(h=Math.max(1,u-5+1));for(let g=h;g<=u;g++)c.push(g);return c})();return e.jsxs("div",{className:"flex items-center justify-between mt-6 px-4 py-3 bg-white border border-gray-200 rounded-lg",children:[e.jsxs("div",{className:"flex sm:hidden items-center justify-between w-full",children:[e.jsx("button",{onClick:()=>x(a-1),disabled:a===1,className:`px-3 py-2 text-sm rounded-md ${a===1?"opacity-50 cursor-not-allowed bg-gray-100 text-gray-400":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 cursor-pointer"}`,children:"← Prev"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Page ",a," of ",n]}),e.jsx("button",{onClick:()=>x(a+1),disabled:a===n,className:`px-3 py-2 text-sm rounded-md ${a===n?"opacity-50 cursor-not-allowed bg-gray-100 text-gray-400":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 cursor-pointer"}`,children:"Next →"})]}),e.jsxs("div",{className:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Page ",a," of ",n]})}),e.jsxs("nav",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>x(a-1),disabled:a===1,className:`px-3 py-1 text-sm rounded-md ${a===1?"opacity-50 cursor-not-allowed bg-gray-100 text-gray-400":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 cursor-pointer"}`,children:"Previous"}),b.map(c=>e.jsx("button",{onClick:()=>x(c),className:`px-3 py-1 text-sm rounded-md ${c===a?"bg-blue-500 text-white":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50"}`,children:c},c)),e.jsx("button",{onClick:()=>x(a+1),disabled:a===n,className:`px-3 py-1 text-sm rounded-md ${a===n?"opacity-50 cursor-not-allowed bg-gray-100 text-gray-400":"bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 cursor-pointer"}`,children:"Next"})]})]})]})};function je(){const[a,n]=o.useState([]),[x,E]=o.useState(!0),[b,c]=o.useState(null),[w,h]=o.useState(1),[u]=o.useState(5),[g,C]=o.useState(!1),[L,k]=o.useState(!1),[y,j]=o.useState(!1),[p,$]=o.useState(null),[R,N]=o.useState({}),[J,v]=o.useState({});o.useEffect(()=>{(async()=>{try{const r=await fetch("/getUsers");if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const t=await r.json();console.log("API Response:",t),Array.isArray(t)?n(t):t&&Array.isArray(t.users)?n(t.users):t&&Array.isArray(t.data)?n(t.data):(console.warn("Unexpected API response format:",t),n([]))}catch(r){console.error("Error fetching users:",r),c(r.message),n([])}finally{E(!1)}})()},[]);const m=Array.isArray(a)?a:[],V=Math.ceil(m.length/u),U=w*u,_=U-u,M=m.slice(_,U),q=s=>{if(s==="1")if(m.some(t=>t.username?.toLowerCase()==="admin")){const d=m.filter(l=>l.role_id===1||l.role?.role_name==="Admin").map(l=>{if(l.username?.toLowerCase()==="admin")return 0;const I=l.username?.match(/admin(\d+)/i);return I?parseInt(I[1]):0}).filter(l=>l>=0),i=d.length>0?Math.max(...d):0;return i===0?"admin1":`admin${i+1}`}else return"admin";else if(s==="2"){const t=m.filter(i=>i.role_id===2||i.role?.role_name==="Judge").map(i=>{const l=i.username?.match(/judge(\d+)/i);return l?parseInt(l[1]):0}).filter(i=>i>0);return`judge${(t.length>0?Math.max(...t):0)+1}`}return""},P=o.useMemo(()=>[{name:"role_id",label:"Role",type:"select",options:[{value:"1",label:"Admin"},{value:"2",label:"Judge"}],required:!0},{name:"is_active",label:"Status",type:"select",options:[{value:"1",label:"Active"},{value:"0",label:"Inactive"}],required:!0}],[]),B=o.useMemo(()=>[{name:"is_active",label:"Status",type:"select",options:[{value:"1",label:"Active"},{value:"0",label:"Inactive"}],required:!0}],[]),O=()=>{N({role_id:"",is_active:"1"}),C(!0)},W=()=>{C(!1),N({})},G=s=>{$(s),v({is_active:s.is_active?.toString()||"1"}),k(!0)},H=()=>{k(!1),$(null),v({})},Y=s=>{N(s)},z=s=>{v(s)},A=async()=>{try{const s=await fetch("/getUsers");if(s.ok){const r=await s.json();Array.isArray(r)?n(r):r&&Array.isArray(r.users)?n(r.users):r&&Array.isArray(r.data)&&n(r.data)}}catch(s){console.error("Error refetching users:",s)}},K=s=>new Promise((r,t)=>{j(!0);const d=q(s.role_id),i={...s,username:d,password:"12345678"};console.log("Adding user with data:",i),S.post("/add/newUser",i,{onSuccess:()=>{f("success",`${d} added successfully!`),A(),r()},onError:l=>{console.error(l),f("error","Failed to add user"),t(l)},onFinish:()=>{j(!1)}})}),Q=s=>new Promise((r,t)=>{j(!0);const d={is_active:s.is_active};console.log("Updating user status:",d),S.patch(`/edit/user/${p.id}`,d,{onSuccess:()=>{f("success","User status updated successfully"),A(),r()},onError:i=>{f("error","Failed to update user status"),t(i)},onFinish:()=>j(!1)})}),X=async s=>{await me("Are you sure?","This will delete the user permanently!","Yes, delete it")&&S.delete(`/delete/user/${s}`,{onSuccess:()=>{f("success","User deleted successfully"),A()},onError:()=>f("error","Failed to delete user")})},D=s=>{if(!s)return"No username";const r=s.toLowerCase();if(r==="admin")return"Admin";if(r.startsWith("admin")){const t=r.replace("admin","");return`Admin ${t||""}`.trim()}else if(r.startsWith("judge")){const t=r.replace("judge","");return`Judge ${t||""}`.trim()}else return s.split(" ").map(t=>t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()).join(" ")},Z=s=>{const t={Admin:{icon:oe,color:"text-red-600"},Judge:{icon:ie,color:"text-blue-600"}}[s]||{icon:F,color:"text-gray-600"},d=t.icon;return e.jsx(d,{className:`w-5 h-5 ${t.color}`})},ee=s=>{h(s),window.scrollTo({top:0,behavior:"smooth"})},se=s=>{const t={Admin:{color:"bg-red-100 text-red-800"},Judge:{color:"bg-blue-100 text-blue-800"}}[s]||{color:"bg-gray-100 text-gray-800"};return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.color}`,children:s})},te=s=>s?e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(le,{className:"w-3 h-3 mr-1"}),"Active"]}):e.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:[e.jsx(de,{className:"w-3 h-3 mr-1"}),"Inactive"]});return x?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):b?e.jsx("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:e.jsxs("div",{className:"p-6 text-center",children:[e.jsxs("div",{className:"text-red-600 mb-4",children:[e.jsx(F,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("h3",{className:"text-lg font-semibold",children:"Error Loading Users"}),e.jsx("p",{className:"text-sm mt-1",children:b})]}),e.jsx("button",{onClick:()=>window.location.reload(),className:"inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-150",children:"Retry"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Users Management"})}),e.jsxs(ce,{onClick:O,children:[e.jsx(re,{className:"mr-2"})," Add User"]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"User"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{scope:"col",className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:M.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"px-4 py-6 text-center text-sm text-gray-500",children:e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsx(F,{className:"w-10 h-10 text-gray-300 mb-2"}),e.jsx("p",{children:"No users found"}),e.jsx("p",{className:"text-xs mt-1",children:"Get started by creating a new user"})]})})}):M.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors duration-150",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 w-6 h-6 flex items-center justify-center",children:Z(s.role?.role_name)}),e.jsx("div",{className:"ml-3",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:D(s.username)})})]})}),e.jsx("td",{className:"px-4 py-3",children:se(s.role?.role_name||"Unknown")}),e.jsx("td",{className:"px-4 py-3",children:te(s.is_active)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-1",children:[e.jsxs("button",{onClick:()=>G(s),className:"inline-flex items-center px-2 py-1 border border-gray-300 rounded text-xs font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-1 focus:ring-blue-500 transition-colors duration-150",children:[e.jsx(ae,{className:"w-3 h-3 mr-1"}),"Edit"]}),e.jsxs("button",{onClick:()=>X(s.id),className:"inline-flex items-center px-2 py-1 border border-transparent rounded text-xs font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-1 focus:ring-red-500 transition-colors duration-150",children:[e.jsx(ne,{className:"w-3 h-3 mr-1"}),"Delete"]})]})})]},s.id))})]})}),m.length>0&&e.jsx("div",{className:"px-4 py-3 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between space-y-2 sm:space-y-0",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",e.jsx("span",{className:"font-medium",children:_+1})," to"," ",e.jsx("span",{className:"font-medium",children:Math.min(U,m.length)})," of"," ",e.jsx("span",{className:"font-medium",children:m.length})," users"]}),e.jsx(xe,{currentPage:w,totalPages:V,onPageChange:ee})]})})]}),e.jsx(T,{show:g,onClose:W,title:"Add User",fields:P,onSubmit:K,submitText:y?"Adding...":"Add User",processing:y,formData:R,onFormChange:Y},`add-user-${g}`),e.jsx(T,{show:L,onClose:H,title:`Editing - ${p?D(p.username):""}`,initialData:p,fields:B,onSubmit:Q,submitText:y?"Saving...":"Save Changes",processing:y,formData:J,onFormChange:z},`edit-user-${p?.id||"none"}`)]})}export{je as default};
