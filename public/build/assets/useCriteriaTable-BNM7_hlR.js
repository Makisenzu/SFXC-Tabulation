import{r as a,b as v,j as c}from"./app-CYmQ_d1T.js";import{c as H,s}from"./Sweetalert-F4Ou2dWC.js";function Ge(){const[u,L]=a.useState("events"),[S,o]=a.useState([]),[x,l]=a.useState([]),[z,w]=a.useState(!0),[W,Y]=a.useState(null),[Me,C]=a.useState(1),[Te]=a.useState(5),[G,D]=a.useState(!1),[K,F]=a.useState(!1),[Q,P]=a.useState(!1),[V,q]=a.useState(!1),[X,M]=a.useState(!1),[Z,d]=a.useState(!1),[T,$]=a.useState(null),[j,N]=a.useState(null),[ee,I]=a.useState(null),[te,g]=a.useState({}),[re,m]=a.useState({}),[ae,h]=a.useState({}),[ne,f]=a.useState({}),[B,E]=a.useState(new Set),[y,se]=a.useState(!1),[b,R]=a.useState({current_page:1,last_page:1,per_page:10,total:0}),i=Array.isArray(S)?S:[],_=Array.isArray(x)?x:[];a.useEffect(()=>{(async()=>{w(!0);try{if(u==="events"){const t=await fetch(`/getEvents?page=${b.current_page}&per_page=10&show_past=${y}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();console.log("Events API Response:",r),r&&Array.isArray(r.data)?(o(r.data),R({current_page:r.current_page,last_page:r.last_page,per_page:r.per_page,total:r.total})):Array.isArray(r)?o(r):r&&Array.isArray(r.events)?o(r.events):(console.warn("Unexpected events API response format:",r),o([]))}else{const t=await fetch("/getCriterias");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();console.log("Criterias API Response:",r),Array.isArray(r)?l(r):r&&Array.isArray(r.criterias)?l(r.criterias):r&&Array.isArray(r.data)?l(r.data):(console.warn("Unexpected criterias API response format:",r),l([]))}}catch(t){console.error(`Error fetching ${u}:`,t),Y(t.message),u==="events"?o([]):l([])}finally{w(!1)}})()},[u,y,b.current_page]);const A=a.useMemo(()=>{const e={};return _.forEach(t=>{const r=t.event_id;e[r]||(e[r]=[]),e[r].push(t)}),e},[_]),k=a.useMemo(()=>i.filter(e=>A[e.id]?.length>0),[i,A]),{currentEvents:ie,pastEvents:oe}=a.useMemo(()=>{const e=new Date;e.setHours(0,0,0,0);const t=[],r=[];return i.forEach(n=>{const O=new Date(n.event_start),J=new Date(n.event_end);O.setHours(0,0,0,0),J.setHours(0,0,0,0),O>=e||J>=e?t.push(n):r.push(n)}),{currentEvents:t,pastEvents:r}},[i]),le=e=>{const t=new Set(B);t.has(e)?t.delete(e):t.add(e),E(t)},de=()=>{const e=new Set(k.map(t=>t.id));E(e)},ce=()=>{E(new Set)},ue=e=>{if(!e)return"N/A";try{const t=new Date(e),r=t.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}),n=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return`${r} ${n}`}catch(t){return console.error("Error formatting date:",t),"Invalid Date"}},U=e=>{if(!e)return"";try{const t=new Date(e),r=t.getTimezoneOffset()*6e4;return new Date(t.getTime()-r).toISOString().slice(0,16)}catch(t){return console.error("Error formatting date for input:",t),""}},pe=e=>`Round ${e.valid_round||"1"}`,ve=a.useMemo(()=>[{name:"event_name",label:"Event Name",type:"text",required:!0,placeholder:"Enter event name"},{name:"event_type",label:"Event Type",type:"select",options:[{value:"Pageant",label:"Pageant"},{value:"Singing",label:"Singing"},{value:"Dancing",label:"Dancing"},{value:"Others",label:"Others"}],required:!0},{name:"description",label:"Description",type:"textarea",required:!1,placeholder:"Enter event description"},{name:"event_start",label:"Event Start",type:"datetime-local",required:!0},{name:"event_end",label:"Event End",type:"datetime-local",required:!0},{name:"is_active",label:"Status",type:"select",options:[{value:"1",label:"Active"},{value:"0",label:"Inactive"}],required:!0}],[]),ge=a.useMemo(()=>[{name:"event_name",label:"Event Name",type:"text",required:!0,placeholder:"Enter event name"},{name:"event_type",label:"Event Type",type:"select",options:[{value:"Pageant",label:"Pageant"},{value:"Singing",label:"Singing"},{value:"Dancing",label:"Dancing"},{value:"Others",label:"Others"}],required:!0},{name:"description",label:"Description",type:"textarea",required:!1,placeholder:"Enter event description"},{name:"event_start",label:"Event Start",type:"datetime-local",required:!0},{name:"event_end",label:"Event End",type:"datetime-local",required:!0},{name:"is_active",label:"Status",type:"select",options:[{value:"1",label:"Active"},{value:"0",label:"Inactive"}],required:!0},{name:"is_archived",label:"Archive Status",type:"select",options:[{value:"1",label:"Archived"},{value:"0",label:"Not Archived"}],required:!0}],[]),me=a.useMemo(()=>[{name:"event_id",label:"Event",type:"select",options:i.filter(e=>e.is_active).map(e=>({value:e.id,label:`${e.event_name} - ${e.event_type}`})),required:!0},{name:"criteria_desc",label:"Criteria",type:"text",required:!0,placeholder:"Enter criteria name"},{name:"definition",label:"Description",type:"textarea",required:!1,placeholder:"Enter criteria definition"},{name:"percentage",label:"Criteria %",type:"number",required:!0,min:0,max:100,step:.1,placeholder:"Enter percentage (0-100)"},{name:"valid_round",label:"Round Number",type:"number",required:!0,min:1,placeholder:"Enter round number (e.g., 1, 2, 3)"},{name:"is_active",label:"Status",type:"select",options:[{value:"1",label:"Active"},{value:"0",label:"Inactive"}],required:!0}],[i]),he=a.useMemo(()=>[{name:"event_id",label:"Event",type:"select",options:i.filter(e=>e.is_active).map(e=>({value:e.id,label:`${e.event_name} - ${e.event_type}`})),required:!0},{name:"criteria_desc",label:"Criteria",type:"text",required:!0,placeholder:"Enter criteria description"},{name:"definition",label:"Description",type:"textarea",required:!1,placeholder:"Enter criteria definition"},{name:"percentage",label:"Criteria %",type:"number",required:!0,min:0,max:100,step:.1,placeholder:"Enter percentage (0-100)"},{name:"valid_round",label:"Round Number",type:"number",required:!0,min:1,placeholder:"Enter round number"},{name:"is_active",label:"Status",type:"select",options:[{value:"1",label:"Active"},{value:"0",label:"Inactive"}],required:!0}],[i]),fe=()=>{g({event_name:"",event_type:"",description:"",event_start:"",event_end:"",is_active:"1",is_archived:"0"}),D(!0)},Ee=()=>{D(!1),g({})},ye=e=>{$(e),m({event_name:e.event_name||"",event_type:e.event_type||"",description:e.description||"",event_start:e.event_start?U(e.event_start):"",event_end:e.event_end?U(e.event_end):"",is_active:e.is_active?.toString()||"1",is_archived:e.is_archived?.toString()||"0"}),F(!0)},be=()=>{F(!1),$(null),m({})},_e=()=>{h({event_id:"",criteria_desc:"",definition:"",percentage:"",valid_round:"1",is_active:"1"}),P(!0)},Ae=()=>{P(!1),h({})},Se=e=>{N(e),f({event_id:e.event_id?.toString()||"",criteria_desc:e.criteria_desc||"",definition:e.definition||"",percentage:e.percentage?.toString()||"",valid_round:e.valid_round?.toString()||"1",is_active:e.is_active?.toString()||"1"}),q(!0)},xe=()=>{q(!1),N(null),f({})},we=e=>{I(e),M(!0)},Ce=()=>{M(!1),I(null)},De=e=>{g(e)},Fe=e=>{m(e)},Pe=e=>{h(e)},qe=e=>{f(e)},p=async()=>{try{if(u==="events"){const e=await fetch("/getEvents");if(e.ok){const t=await e.json();Array.isArray(t)?o(t):t&&Array.isArray(t.events)?o(t.events):t&&Array.isArray(t.data)&&o(t.data)}}else{const e=await fetch("/getCriterias");if(e.ok){const t=await e.json();Array.isArray(t)?l(t):t&&Array.isArray(t.criterias)?l(t.criterias):t&&Array.isArray(t.data)&&l(t.data)}}}catch(e){console.error("Error refetching data:",e)}};return{activeTab:u,safeEvents:i,safeCriterias:_,eventsWithCriteria:k,criteriaByEvent:A,currentEvents:ie,pastEvents:oe,loading:z,error:W,expandedEvents:B,showAddEventModal:G,showEditEventModal:K,showAddCriteriaModal:Q,showEditCriteriaModal:V,showAddJudgesModal:X,processing:Z,editingEvent:T,editingCriteria:j,selectedEventForJudges:ee,addEventFormData:te,editEventFormData:re,addCriteriaFormData:ae,editCriteriaFormData:ne,showPastEvents:y,setShowPastEvents:se,eventsPagination:b,setEventsPagination:R,addEventFields:ve,editEventFields:ge,addCriteriaFields:me,editCriteriaFields:he,toggleEventExpansion:le,expandAllEvents:de,collapseAllEvents:ce,formatDateWithTime:ue,getStatusBadge:e=>e?c.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Active"}):c.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"Inactive"}),getArchiveBadge:e=>e?c.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Archived"}):c.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Current"}),getEventTypeBadge:e=>{const r={Pageant:{color:"bg-pink-100 text-pink-800"},Singing:{color:"bg-indigo-100 text-indigo-800"},Dancing:{color:"bg-orange-100 text-orange-800"}}[e]||{color:"bg-gray-100 text-gray-800"};return c.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${r.color}`,children:e?e.charAt(0).toUpperCase()+e.slice(1):"Unknown"})},getPercentageDisplay:e=>c.jsx("div",{className:"text-center",children:c.jsxs("span",{className:"text-lg font-semibold text-blue-600",children:[e,"%"]})}),getRoundBadge:e=>{const t=pe(e);return c.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-white-100 text-black-800",children:t})},handleTabChange:e=>{L(e),C(1)},handlePageChange:e=>{C(e),window.scrollTo({top:0,behavior:"smooth"})},openAddEvent:fe,closeAddEvent:Ee,openEditEvent:ye,closeEditEvent:be,openAddCriteria:_e,closeAddCriteria:Ae,openEditCriteria:Se,closeEditCriteria:xe,openAddJudges:we,closeAddJudgesModal:Ce,handleAddEventFormChange:De,handleEditEventFormChange:Fe,handleAddCriteriaFormChange:Pe,handleEditCriteriaFormChange:qe,handleAddEventSubmit:e=>new Promise((t,r)=>{d(!0),console.log("Adding event with data:",e),v.post("/addEvent",e,{onSuccess:()=>{s("success","Event added successfully!"),p(),t()},onError:n=>{console.error(n),s("error","Failed to add event"),r(n)},onFinish:()=>{d(!1)}})}),handleEditEventSubmit:e=>new Promise((t,r)=>{d(!0),console.log("Updating event with data:",e),v.put(`/events/${T.id}`,e,{onSuccess:()=>{s("success","Event updated successfully"),p(),t()},onError:n=>{s("error","Failed to update event"),r(n)},onFinish:()=>d(!1)})}),handleAddCriteriaSubmit:e=>new Promise((t,r)=>{d(!0),console.log("Adding criteria with data:",e),v.post("/criterias",e,{onSuccess:()=>{s("success","Criteria added successfully!"),p(),t()},onError:n=>{console.error(n),s("error","Failed to add criteria"),r(n)},onFinish:()=>{d(!1)}})}),handleEditCriteriaSubmit:e=>new Promise((t,r)=>{d(!0),console.log("Updating criteria with data:",e),v.patch(`/criterias/${j.id}`,e,{onSuccess:()=>{s("success","Criteria updated successfully"),p(),t()},onError:n=>{s("error","Failed to update criteria"),r(n)},onFinish:()=>d(!1)})}),handleDeleteEvent:async e=>{await H("Are you sure?","This will delete the event and all its criteria permanently!","Yes, delete it")&&v.delete(`/events/${e}`,{onSuccess:()=>{s("success","Event deleted successfully"),p()},onError:()=>s("error","Failed to delete event")})},handleDeleteCriteria:async e=>{await H("Are you sure?","This will delete the criteria permanently!","Yes, delete it")&&v.delete(`/criterias/${e}`,{onSuccess:()=>{s("success","Criteria deleted successfully"),p()},onError:()=>s("error","Failed to delete criteria")})}}}export{Ge as useCriteriaTable};
