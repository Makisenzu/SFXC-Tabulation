import{r as a,b as p,j as d}from"./app-Bx3wU7Nx.js";import{c as R,s as i}from"./Sweetalert-BpxYOqBL.js";function ke(){const[u,U]=a.useState("events"),[A,s]=a.useState([]),[S,o]=a.useState([]),[k,x]=a.useState(!0),[O,J]=a.useState(null),[xe,_]=a.useState(1),[_e]=a.useState(5),[L,C]=a.useState(!1),[z,w]=a.useState(!1),[H,D]=a.useState(!1),[W,F]=a.useState(!1),[Y,q]=a.useState(!1),[G,l]=a.useState(!1),[P,M]=a.useState(null),[T,j]=a.useState(null),[K,N]=a.useState(null),[Q,m]=a.useState({}),[V,g]=a.useState({}),[X,f]=a.useState({}),[Z,h]=a.useState({}),[$,E]=a.useState(new Set),c=Array.isArray(A)?A:[],y=Array.isArray(S)?S:[];a.useEffect(()=>{(async()=>{x(!0);try{if(u==="events"){const t=await fetch("/getEvents");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();console.log("Events API Response:",r),Array.isArray(r)?s(r):r&&Array.isArray(r.events)?s(r.events):r&&Array.isArray(r.data)?s(r.data):(console.warn("Unexpected events API response format:",r),s([]))}else{const t=await fetch("/getCriterias");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();console.log("Criterias API Response:",r),Array.isArray(r)?o(r):r&&Array.isArray(r.criterias)?o(r.criterias):r&&Array.isArray(r.data)?o(r.data):(console.warn("Unexpected criterias API response format:",r),o([]))}}catch(t){console.error(`Error fetching ${u}:`,t),J(t.message),u==="events"?s([]):o([])}finally{x(!1)}})()},[u]);const b=a.useMemo(()=>{const e={};return y.forEach(t=>{const r=t.event_id;e[r]||(e[r]=[]),e[r].push(t)}),e},[y]),I=a.useMemo(()=>c.filter(e=>b[e.id]?.length>0),[c,b]),ee=e=>{const t=new Set($);t.has(e)?t.delete(e):t.add(e),E(t)},te=()=>{const e=new Set(I.map(t=>t.id));E(e)},re=()=>{E(new Set)},ae=e=>{if(!e)return"N/A";try{const t=new Date(e),r=t.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}),n=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return`${r} ${n}`}catch(t){return console.error("Error formatting date:",t),"Invalid Date"}},B=e=>{if(!e)return"";try{const t=new Date(e),r=t.getTimezoneOffset()*6e4;return new Date(t.getTime()-r).toISOString().slice(0,16)}catch(t){return console.error("Error formatting date for input:",t),""}},ne=e=>`Round ${e.valid_round||"1"}`,ie=a.useMemo(()=>[{name:"event_name",label:"Event Name",type:"text",required:!0,placeholder:"Enter event name"},{name:"event_type",label:"Event Type",type:"select",options:[{value:"Pageant",label:"Pageant"},{value:"Singing",label:"Singing"},{value:"Dancing",label:"Dancing"},{value:"Others",label:"Others"}],required:!0},{name:"description",label:"Description",type:"textarea",required:!1,placeholder:"Enter event description"},{name:"event_start",label:"Event Start",type:"datetime-local",required:!0},{name:"event_end",label:"Event End",type:"datetime-local",required:!0},{name:"is_active",label:"Status",type:"select",options:[{value:"1",label:"Active"},{value:"0",label:"Inactive"}],required:!0}],[]),se=a.useMemo(()=>[{name:"event_name",label:"Event Name",type:"text",required:!0,placeholder:"Enter event name"},{name:"event_type",label:"Event Type",type:"select",options:[{value:"Pageant",label:"Pageant"},{value:"Singing",label:"Singing"},{value:"Dancing",label:"Dancing"},{value:"Others",label:"Others"}],required:!0},{name:"description",label:"Description",type:"textarea",required:!1,placeholder:"Enter event description"},{name:"event_start",label:"Event Start",type:"datetime-local",required:!0},{name:"event_end",label:"Event End",type:"datetime-local",required:!0},{name:"is_active",label:"Status",type:"select",options:[{value:"1",label:"Active"},{value:"0",label:"Inactive"}],required:!0},{name:"is_archived",label:"Archive Status",type:"select",options:[{value:"1",label:"Archived"},{value:"0",label:"Not Archived"}],required:!0}],[]),oe=a.useMemo(()=>[{name:"event_id",label:"Event",type:"select",options:c.filter(e=>e.is_active).map(e=>({value:e.id,label:`${e.event_name} - ${e.event_type}`})),required:!0},{name:"criteria_desc",label:"Criteria",type:"text",required:!0,placeholder:"Enter criteria name"},{name:"definition",label:"Description",type:"textarea",required:!1,placeholder:"Enter criteria definition"},{name:"percentage",label:"Criteria %",type:"number",required:!0,min:0,max:100,step:.1,placeholder:"Enter percentage (0-100)"},{name:"valid_round",label:"Round Number",type:"number",required:!0,min:1,placeholder:"Enter round number (e.g., 1, 2, 3)"},{name:"is_active",label:"Status",type:"select",options:[{value:"1",label:"Active"},{value:"0",label:"Inactive"}],required:!0}],[c]),le=a.useMemo(()=>[{name:"event_id",label:"Event",type:"select",options:c.filter(e=>e.is_active).map(e=>({value:e.id,label:`${e.event_name} - ${e.event_type}`})),required:!0},{name:"criteria_desc",label:"Criteria",type:"text",required:!0,placeholder:"Enter criteria description"},{name:"definition",label:"Description",type:"textarea",required:!1,placeholder:"Enter criteria definition"},{name:"percentage",label:"Criteria %",type:"number",required:!0,min:0,max:100,step:.1,placeholder:"Enter percentage (0-100)"},{name:"valid_round",label:"Round Number",type:"number",required:!0,min:1,placeholder:"Enter round number"},{name:"is_active",label:"Status",type:"select",options:[{value:"1",label:"Active"},{value:"0",label:"Inactive"}],required:!0}],[c]),de=()=>{m({event_name:"",event_type:"",description:"",event_start:"",event_end:"",is_active:"1",is_archived:"0"}),C(!0)},ce=()=>{C(!1),m({})},ue=e=>{M(e),g({event_name:e.event_name||"",event_type:e.event_type||"",description:e.description||"",event_start:e.event_start?B(e.event_start):"",event_end:e.event_end?B(e.event_end):"",is_active:e.is_active?.toString()||"1",is_archived:e.is_archived?.toString()||"0"}),w(!0)},ve=()=>{w(!1),M(null),g({})},pe=()=>{f({event_id:"",criteria_desc:"",definition:"",percentage:"",valid_round:"1",is_active:"1"}),D(!0)},me=()=>{D(!1),f({})},ge=e=>{j(e),h({event_id:e.event_id?.toString()||"",criteria_desc:e.criteria_desc||"",definition:e.definition||"",percentage:e.percentage?.toString()||"",valid_round:e.valid_round?.toString()||"1",is_active:e.is_active?.toString()||"1"}),F(!0)},fe=()=>{F(!1),j(null),h({})},he=e=>{N(e),q(!0)},Ee=()=>{q(!1),N(null)},ye=e=>{m(e)},be=e=>{g(e)},Ae=e=>{f(e)},Se=e=>{h(e)},v=async()=>{try{if(u==="events"){const e=await fetch("/getEvents");if(e.ok){const t=await e.json();Array.isArray(t)?s(t):t&&Array.isArray(t.events)?s(t.events):t&&Array.isArray(t.data)&&s(t.data)}}else{const e=await fetch("/getCriterias");if(e.ok){const t=await e.json();Array.isArray(t)?o(t):t&&Array.isArray(t.criterias)?o(t.criterias):t&&Array.isArray(t.data)&&o(t.data)}}}catch(e){console.error("Error refetching data:",e)}};return{activeTab:u,safeEvents:c,safeCriterias:y,eventsWithCriteria:I,criteriaByEvent:b,loading:k,error:O,expandedEvents:$,showAddEventModal:L,showEditEventModal:z,showAddCriteriaModal:H,showEditCriteriaModal:W,showAddJudgesModal:Y,processing:G,editingEvent:P,editingCriteria:T,selectedEventForJudges:K,addEventFormData:Q,editEventFormData:V,addCriteriaFormData:X,editCriteriaFormData:Z,addEventFields:ie,editEventFields:se,addCriteriaFields:oe,editCriteriaFields:le,toggleEventExpansion:ee,expandAllEvents:te,collapseAllEvents:re,formatDateWithTime:ae,getStatusBadge:e=>e?d.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Active"}):d.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"Inactive"}),getArchiveBadge:e=>e?d.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Archived"}):d.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Current"}),getEventTypeBadge:e=>{const r={Pageant:{color:"bg-pink-100 text-pink-800"},Singing:{color:"bg-indigo-100 text-indigo-800"},Dancing:{color:"bg-orange-100 text-orange-800"}}[e]||{color:"bg-gray-100 text-gray-800"};return d.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${r.color}`,children:e?e.charAt(0).toUpperCase()+e.slice(1):"Unknown"})},getPercentageDisplay:e=>d.jsx("div",{className:"text-center",children:d.jsxs("span",{className:"text-lg font-semibold text-blue-600",children:[e,"%"]})}),getRoundBadge:e=>{const t=ne(e);return d.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:t})},handleTabChange:e=>{U(e),_(1)},handlePageChange:e=>{_(e),window.scrollTo({top:0,behavior:"smooth"})},openAddEvent:de,closeAddEvent:ce,openEditEvent:ue,closeEditEvent:ve,openAddCriteria:pe,closeAddCriteria:me,openEditCriteria:ge,closeEditCriteria:fe,openAddJudges:he,closeAddJudgesModal:Ee,handleAddEventFormChange:ye,handleEditEventFormChange:be,handleAddCriteriaFormChange:Ae,handleEditCriteriaFormChange:Se,handleAddEventSubmit:e=>new Promise((t,r)=>{l(!0),console.log("Adding event with data:",e),p.post("/addEvent",e,{onSuccess:()=>{i("success","Event added successfully!"),v(),t()},onError:n=>{console.error(n),i("error","Failed to add event"),r(n)},onFinish:()=>{l(!1)}})}),handleEditEventSubmit:e=>new Promise((t,r)=>{l(!0),console.log("Updating event with data:",e),p.put(`/events/${P.id}`,e,{onSuccess:()=>{i("success","Event updated successfully"),v(),t()},onError:n=>{i("error","Failed to update event"),r(n)},onFinish:()=>l(!1)})}),handleAddCriteriaSubmit:e=>new Promise((t,r)=>{l(!0),console.log("Adding criteria with data:",e),p.post("/criterias",e,{onSuccess:()=>{i("success","Criteria added successfully!"),v(),t()},onError:n=>{console.error(n),i("error","Failed to add criteria"),r(n)},onFinish:()=>{l(!1)}})}),handleEditCriteriaSubmit:e=>new Promise((t,r)=>{l(!0),console.log("Updating criteria with data:",e),p.patch(`/criterias/${T.id}`,e,{onSuccess:()=>{i("success","Criteria updated successfully"),v(),t()},onError:n=>{i("error","Failed to update criteria"),r(n)},onFinish:()=>l(!1)})}),handleDeleteEvent:async e=>{await R("Are you sure?","This will delete the event and all its criteria permanently!","Yes, delete it")&&p.delete(`/events/${e}`,{onSuccess:()=>{i("success","Event deleted successfully"),v()},onError:()=>i("error","Failed to delete event")})},handleDeleteCriteria:async e=>{await R("Are you sure?","This will delete the criteria permanently!","Yes, delete it")&&p.delete(`/criterias/${e}`,{onSuccess:()=>{i("success","Criteria deleted successfully"),v()},onError:()=>i("error","Failed to delete criteria")})}}}export{ke as useCriteriaTable};
