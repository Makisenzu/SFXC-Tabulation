import{r as n,b as g,j as i}from"./app-DtBfZdBf.js";import{c as Y,s}from"./Sweetalert-CEnMs4I5.js";function Qe(){const[u,G]=n.useState("events"),[D,o]=n.useState([]),[F,l]=n.useState([]),[K,P]=n.useState(!0),[Q,V]=n.useState(null),[je,q]=n.useState(1),[$e]=n.useState(5),[X,M]=n.useState(!1),[Z,T]=n.useState(!1),[ee,j]=n.useState(!1),[te,$]=n.useState(!1),[re,N]=n.useState(!1),[ne,d]=n.useState(!1),[I,H]=n.useState(null),[B,R]=n.useState(null),[ae,k]=n.useState(null),[se,E]=n.useState({}),[ie,y]=n.useState({}),[oe,b]=n.useState({}),[le,_]=n.useState({}),[U,S]=n.useState(new Set),[m,de]=n.useState(!1),[A,O]=n.useState({current_page:1,last_page:1,per_page:10,total:0}),p=Array.isArray(D)?D:[],x=Array.isArray(F)?F:[];n.useEffect(()=>{(async()=>{P(!0);try{if(u==="events"){const t=await fetch(`/getEvents?page=${A.current_page}&per_page=10&show_past=${m}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();console.log("Events API Response:",r),r&&Array.isArray(r.data)?(o(r.data),O({current_page:r.current_page,last_page:r.last_page,per_page:r.per_page,total:r.total})):Array.isArray(r)?o(r):r&&Array.isArray(r.events)?o(r.events):(console.warn("Unexpected events API response format:",r),o([]))}else{const t=await fetch("/getCriterias");if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();console.log("Criterias API Response:",r),Array.isArray(r)?l(r):r&&Array.isArray(r.criterias)?l(r.criterias):r&&Array.isArray(r.data)?l(r.data):(console.warn("Unexpected criterias API response format:",r),l([]))}}catch(t){console.error(`Error fetching ${u}:`,t),V(t.message),u==="events"?o([]):l([])}finally{P(!1)}})()},[u,m,A.current_page]);const w=n.useMemo(()=>{const e={};return x.forEach(t=>{const r=t.event_id;e[r]||(e[r]=[]),e[r].push(t)}),e},[x]),C=n.useMemo(()=>p.filter(e=>w[e.id]?.length>0),[p,w]),{currentEvents:f,pastEvents:J}=n.useMemo(()=>{const e=new Date;e.setHours(0,0,0,0);const t=[],r=[];return p.forEach(a=>{const c=new Date(a.event_start),h=new Date(a.event_end);c.setHours(0,0,0,0),h.setHours(0,0,0,0),c>=e||h>=e?t.push(a):r.push(a)}),{currentEvents:t,pastEvents:r}},[p]),{currentEventsWithCriteria:W,pastEventsWithCriteria:L}=n.useMemo(()=>{const e=new Date;e.setHours(0,0,0,0);const t=[],r=[];return C.forEach(a=>{const c=new Date(a.event_start),h=new Date(a.event_end);c.setHours(0,0,0,0),h.setHours(0,0,0,0),c>=e||h>=e?t.push(a):r.push(a)}),{currentEventsWithCriteria:t,pastEventsWithCriteria:r}},[C]),ce=e=>{const t=new Set(U);t.has(e)?t.delete(e):t.add(e),S(t)},ue=()=>{const e=u==="criterias"?[...W,...m?L:[]]:[...f,...m?J:[]],t=new Set(e.map(r=>r.id));S(t)},pe=()=>{S(new Set)},ve=e=>{if(!e)return"N/A";try{const t=new Date(e),r=t.toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}),a=t.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});return`${r} ${a}`}catch(t){return console.error("Error formatting date:",t),"Invalid Date"}},z=e=>{if(!e)return"";try{const t=new Date(e),r=t.getTimezoneOffset()*6e4;return new Date(t.getTime()-r).toISOString().slice(0,16)}catch(t){return console.error("Error formatting date for input:",t),""}},ge=e=>`Round ${e.valid_round||"1"}`,me=n.useMemo(()=>[{name:"event_name",label:"Event Name",type:"text",required:!0,placeholder:"Enter event name"},{name:"event_type",label:"Event Type",type:"select",options:[{value:"Pageant",label:"Pageant"},{value:"Singing",label:"Singing"},{value:"Dancing",label:"Dancing"},{value:"Others",label:"Others"}],required:!0},{name:"description",label:"Description",type:"textarea",required:!1,placeholder:"Enter event description"},{name:"event_start",label:"Event Start",type:"datetime-local",required:!0},{name:"event_end",label:"Event End",type:"datetime-local",required:!0},{name:"is_active",label:"Status",type:"select",options:[{value:"1",label:"Active"},{value:"0",label:"Inactive"}],required:!0}],[]),he=n.useMemo(()=>[{name:"event_name",label:"Event Name",type:"text",required:!0,placeholder:"Enter event name"},{name:"event_type",label:"Event Type",type:"select",options:[{value:"Pageant",label:"Pageant"},{value:"Singing",label:"Singing"},{value:"Dancing",label:"Dancing"},{value:"Others",label:"Others"}],required:!0},{name:"description",label:"Description",type:"textarea",required:!1,placeholder:"Enter event description"},{name:"event_start",label:"Event Start",type:"datetime-local",required:!0},{name:"event_end",label:"Event End",type:"datetime-local",required:!0},{name:"is_active",label:"Status",type:"select",options:[{value:"1",label:"Active"},{value:"0",label:"Inactive"}],required:!0},{name:"is_archived",label:"Archive Status",type:"select",options:[{value:"1",label:"Archived"},{value:"0",label:"Not Archived"}],required:!0}],[]),fe=n.useMemo(()=>[{name:"event_id",label:"Event",type:"select",options:f.filter(e=>e.is_active).map(e=>({value:e.id,label:`${e.event_name} - ${e.event_type}`})),required:!0},{name:"criteria_desc",label:"Criteria",type:"text",required:!0,placeholder:"Enter criteria name"},{name:"definition",label:"Description",type:"textarea",required:!1,placeholder:"Enter criteria definition"},{name:"percentage",label:"Criteria %",type:"number",required:!0,min:0,max:100,step:.1,placeholder:"Enter percentage (0-100)"},{name:"valid_round",label:"Round Number",type:"number",required:!0,min:1,placeholder:"Enter round number (e.g., 1, 2, 3)"},{name:"is_active",label:"Status",type:"select",options:[{value:"1",label:"Active"},{value:"0",label:"Inactive"}],required:!0}],[f]),Ee=n.useMemo(()=>[{name:"event_id",label:"Event",type:"select",options:p.filter(e=>e.is_active).map(e=>({value:e.id,label:`${e.event_name} - ${e.event_type}`})),required:!0},{name:"criteria_desc",label:"Criteria",type:"text",required:!0,placeholder:"Enter criteria description"},{name:"definition",label:"Description",type:"textarea",required:!1,placeholder:"Enter criteria definition"},{name:"percentage",label:"Criteria %",type:"number",required:!0,min:0,max:100,step:.1,placeholder:"Enter percentage (0-100)"},{name:"valid_round",label:"Round Number",type:"number",required:!0,min:1,placeholder:"Enter round number"},{name:"is_active",label:"Status",type:"select",options:[{value:"1",label:"Active"},{value:"0",label:"Inactive"}],required:!0}],[p]),ye=()=>{E({event_name:"",event_type:"",description:"",event_start:"",event_end:"",is_active:"1",is_archived:"0"}),M(!0)},be=()=>{M(!1),E({})},_e=e=>{H(e),y({event_name:e.event_name||"",event_type:e.event_type||"",description:e.description||"",event_start:e.event_start?z(e.event_start):"",event_end:e.event_end?z(e.event_end):"",is_active:e.is_active?.toString()||"1",is_archived:e.is_archived?.toString()||"0"}),T(!0)},Se=()=>{T(!1),H(null),y({})},Ae=()=>{b({event_id:"",criteria_desc:"",definition:"",percentage:"",valid_round:"1",is_active:"1"}),j(!0)},xe=()=>{j(!1),b({})},we=e=>{R(e),_({event_id:e.event_id?.toString()||"",criteria_desc:e.criteria_desc||"",definition:e.definition||"",percentage:e.percentage?.toString()||"",valid_round:e.valid_round?.toString()||"1",is_active:e.is_active?.toString()||"1"}),$(!0)},Ce=()=>{$(!1),R(null),_({})},De=e=>{k(e),N(!0)},Fe=()=>{N(!1),k(null)},Pe=e=>{E(e)},qe=e=>{y(e)},Me=e=>{b(e)},Te=e=>{_(e)},v=async()=>{try{if(u==="events"){const e=await fetch("/getEvents");if(e.ok){const t=await e.json();Array.isArray(t)?o(t):t&&Array.isArray(t.events)?o(t.events):t&&Array.isArray(t.data)&&o(t.data)}}else{const e=await fetch("/getCriterias");if(e.ok){const t=await e.json();Array.isArray(t)?l(t):t&&Array.isArray(t.criterias)?l(t.criterias):t&&Array.isArray(t.data)&&l(t.data)}}}catch(e){console.error("Error refetching data:",e)}};return{activeTab:u,safeEvents:p,safeCriterias:x,eventsWithCriteria:C,criteriaByEvent:w,currentEvents:f,pastEvents:J,currentEventsWithCriteria:W,pastEventsWithCriteria:L,loading:K,error:Q,expandedEvents:U,showAddEventModal:X,showEditEventModal:Z,showAddCriteriaModal:ee,showEditCriteriaModal:te,showAddJudgesModal:re,processing:ne,editingEvent:I,editingCriteria:B,selectedEventForJudges:ae,addEventFormData:se,editEventFormData:ie,addCriteriaFormData:oe,editCriteriaFormData:le,showPastEvents:m,setShowPastEvents:de,eventsPagination:A,setEventsPagination:O,addEventFields:me,editEventFields:he,addCriteriaFields:fe,editCriteriaFields:Ee,toggleEventExpansion:ce,expandAllEvents:ue,collapseAllEvents:pe,formatDateWithTime:ve,getStatusBadge:(e,t=null)=>{if(t){const r=new Date;r.setHours(0,0,0,0);const a=new Date(t.event_start),c=new Date(t.event_end);if(a.setHours(0,0,0,0),c.setHours(0,0,0,0),a<r&&c<r)return i.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"Inactive"})}return e?i.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800",children:"Active"}):i.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:"Inactive"})},getArchiveBadge:e=>e?i.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800",children:"Archived"}):i.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Current"}),getEventTypeBadge:e=>{const r={Pageant:{color:"bg-pink-100 text-pink-800"},Singing:{color:"bg-indigo-100 text-indigo-800"},Dancing:{color:"bg-orange-100 text-orange-800"}}[e]||{color:"bg-gray-100 text-gray-800"};return i.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${r.color}`,children:e?e.charAt(0).toUpperCase()+e.slice(1):"Unknown"})},getPercentageDisplay:e=>i.jsx("div",{className:"text-center",children:i.jsxs("span",{className:"text-lg font-semibold text-blue-600",children:[e,"%"]})}),getRoundBadge:e=>{const t=ge(e);return i.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-white-100 text-black-800",children:t})},handleTabChange:e=>{G(e),q(1)},handlePageChange:e=>{q(e),window.scrollTo({top:0,behavior:"smooth"})},openAddEvent:ye,closeAddEvent:be,openEditEvent:_e,closeEditEvent:Se,openAddCriteria:Ae,closeAddCriteria:xe,openEditCriteria:we,closeEditCriteria:Ce,openAddJudges:De,closeAddJudgesModal:Fe,handleAddEventFormChange:Pe,handleEditEventFormChange:qe,handleAddCriteriaFormChange:Me,handleEditCriteriaFormChange:Te,handleAddEventSubmit:e=>new Promise((t,r)=>{d(!0),console.log("Adding event with data:",e),g.post("/addEvent",e,{onSuccess:()=>{s("success","Event added successfully!"),v(),t()},onError:a=>{console.error(a),s("error","Failed to add event"),r(a)},onFinish:()=>{d(!1)}})}),handleEditEventSubmit:e=>new Promise((t,r)=>{d(!0),console.log("Updating event with data:",e),g.put(`/events/${I.id}`,e,{onSuccess:()=>{s("success","Event updated successfully"),v(),t()},onError:a=>{s("error","Failed to update event"),r(a)},onFinish:()=>d(!1)})}),handleAddCriteriaSubmit:e=>new Promise((t,r)=>{d(!0),console.log("Adding criteria with data:",e),g.post("/criterias",e,{onSuccess:()=>{s("success","Criteria added successfully!"),v(),t()},onError:a=>{console.error(a),s("error","Failed to add criteria"),r(a)},onFinish:()=>{d(!1)}})}),handleEditCriteriaSubmit:e=>new Promise((t,r)=>{d(!0),console.log("Updating criteria with data:",e),g.patch(`/criterias/${B.id}`,e,{onSuccess:()=>{s("success","Criteria updated successfully"),v(),t()},onError:a=>{s("error","Failed to update criteria"),r(a)},onFinish:()=>d(!1)})}),handleDeleteEvent:async e=>{await Y("Are you sure?","This will delete the event and all its criteria permanently!","Yes, delete it")&&g.delete(`/events/${e}`,{onSuccess:()=>{s("success","Event deleted successfully"),v()},onError:()=>s("error","Failed to delete event")})},handleDeleteCriteria:async e=>{await Y("Are you sure?","This will delete the criteria permanently!","Yes, delete it")&&g.delete(`/criterias/${e}`,{onSuccess:()=>{s("success","Criteria deleted successfully"),v()},onError:()=>s("error","Failed to delete criteria")})}}}export{Qe as useCriteriaTable};
